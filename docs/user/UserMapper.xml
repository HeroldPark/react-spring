<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="shane.blog.user.UserMapper">

    <!-- tb_user 테이블 전체 컬럼 -->
    <sql id="userColumns">
        user_id
        , id
        , name
        , role
    </sql>


    <!-- 회원 정보 저장 (회원가입) -->
    <insert id="save" parameterType="user" useGeneratedKeys="true" keyProperty="id">
        INSERT INTO tb_user (
            <include refid="userColumns" />
        ) VALUES (
            #{userId}
            , #{id}
            , #{name}
            , #{role}
        )
    </insert>

    <!-- 회원 정보 수정 -->
    <update id="update" parameterType="user">
        UPDATE tb_user
        SET
            id = #{id}
            <if test="name != null and !name.equals('')">
                , name = #{name}
            </if>
            <if test="role != null and !role.equals('')">
                , role = #{role}
            </if>
        WHERE
            user_id = #{userId}
    </update>

    <!-- 회원 상세정보 조회 -->
    <select id="find" parameterType="user" resultType="user">
        SELECT /* id="find" 2024-05-07 by shanepark */
            <include refid="userColumns" />
        FROM
            tb_user
        WHERE true
            <if test="userId != null and !userId.equals('')">
                AND user_id = #{userId}
            </if>
    </select>

    <!-- 회원 상세정보 조회 (페이징) -->
    <select id="findAllWithUsers" parameterType="map" resultType="User">
        SELECT /* id="find" 2024-05-07 by shanepark */
            <include refid="userColumns" />
        FROM
            tb_user
        WHERE true
            <if test="userId != null and !userId.equals('')">
                AND user_id = #{userId}
            </if>
        ORDER BY user_id <!-- Assuming user_id is the unique identifier -->
        LIMIT #{pageable.pageSize} OFFSET #{pageable.offset}
    </select>

    <!-- 회원 정보 삭제 (회원 탈퇴) -->
    <delete id="delete" parameterType="user">
        DETETE FROM tb_user
        WHERE   user_id = #{userId}
    </delete>

    <!-- 회원 수 카운팅 -->
    <select id="count" parameterType="user" resultType="int">
        SELECT
            COUNT(*)
        FROM
            tb_user
        WHERE   true
            <if test="id != null and !id.equals('')">
                AND id = #{id}
            </if>
            <if test="name != null and !name.equals('')">
                AND name = #{name}
            </if>
            <if test="role != null and !role.equals('')">
                AND role = #{role}
            </if>
    </select>

</mapper>